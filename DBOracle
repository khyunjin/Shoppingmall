

/* 회원 테이블 */
create table shop_member_tbl (
id varchar2(30) primary key,
pwd varchar2(30),
name varchar2(10),
gender varchar2(7),
phone1 varchar2(3),
phone2 varchar2(4),
phone3 varchar2(4),
eid varchar2(30),
edomain varchar2(50),
postcode varchar2(8),
address varchar2(120),
detailAddress varchar2(100),
extraAddress varchar2(100),
regdate date default sysdate
);


/* 상품 테이블 */
create table shop_product_tbl (
prodnum number(5) primary key,
name varchar2(200),
kind char(1),						--판매상품 종류 상위그룹(1:OUTER, 2:TOP, 3:PANTS, 4:DRESS&SKIRT)
subkind char(3),					--판매상품 종류 하위그룹(1(상위그룹)01(하위그룹) ex:outer-jacket)
price1 number(7) default '0',		--원가
price2 number(7) default '0',		--판매가
price3 number(7) default '0',		--순수익
content varchar2(1000),				--상품 설명
image varchar2(50),
bestyn char(1) default 'n',			--베스트 상품 여부
newyn char(1) default 'y',			--신상품 여부
regdate date default sysdate
);


insert into shop_product_tbl values(10001, '쇼핑몰테스트옷1','1','102',2000,10000,8000,'테스트용설명입니다','31.jpg','y','y',sysdate);
insert into shop_product_tbl values(10002, '클래식 포멀 싱글 버튼 자켓','1','101',20000,60000,40000,'테스트용설명입니다','26.jpg','y','y',sysdate);


/* 상품 옵션 중 prodcolor(색상) 테이블 */
create table shop_prodcolor_tbl (
prodnum number(5),
prodcolor varchar2(10),
constraint fk_prodcolor foreign key(prodnum) references shop_product_tbl(prodnum) on delete cascade
);


/* 상품 옵션 중 prodsize(사이즈) 테이블 */
create table shop_prodsize_tbl (
prodnum number(5),
prodsize varchar2(10),
constraint fk_prodsize foreign key(prodnum) references shop_product_tbl(prodnum) on delete cascade
);


insert into shop_prodcolor_tbl values(10001, 'blue');
insert into shop_prodcolor_tbl values(10001, 'pink');
insert into shop_prodsize_tbl values(10001, 'free');


/* 장바구니 테이블 */
create table shop_cart_tbl (
cartnum number(5) primary key,		--장바구니 번호
id varchar2(30),					--회원아이디
prodnum number(5),					--상품번호
quantity number(3),					--수량
prodcolor varchar2(10),
prodsize varchar2(10),
deliveryyn char(1) default 'n',		--배송 유무
cartindate date default sysdate,	--카트 담은 날짜
constraint fk_id foreign key(id) references shop_member_tbl(id) on delete cascade,					--회원 탈퇴시 카트 정보 함께 지우며 처리됨
constraint fk_prodnum foreign key(prodnum) references shop_product_tbl(prodnum) on delete cascade
);


/* 장바구니 번호 시퀀스 생성 */
create sequence cartseq
start with 1
increment by 1;

	
/* 장바구니 리스트 조회시 필요한 view 생성 */
create or replace view cart_view
as 
select c.cartnum, c.id, c.prodnum, c.quantity, c.prodcolor, c.prodsize, p.name, p.image, p.price2
from SHOP_CART_TBL c, SHOP_PRODUCT_TBL p, SHOP_MEMBER_TBL m
where c.id = m.id and c.prodnum = p.prodnum;


/* 주문 테이블 */
create table shop_order_tbl (
ordernum number(5) primary key,		--주문 번호
id varchar2(30),					--회원아이디
prodnum number(5),					--상품번호
quantity number(3),					--수량
prodcolor varchar2(10),
prodsize varchar2(10),
ordername varchar2(20),				--받는 사람 이름
orderadd varchar2(200),				--받는 사람 주소
orderphone varchar2(20),			--받는 사람 연락처
orderreq varchar(100),				--배송시 요청사항
deliveryyn char(1) default 'n',		--배송 유무
orderindate date default sysdate,	--주문한 날짜
constraint fk_order_id foreign key(id) references shop_member_tbl(id) on delete cascade,					--회원 탈퇴시 주문 정보 함께 지우며 처리됨
constraint fk_order_prodnum foreign key(prodnum) references shop_product_tbl(prodnum) on delete cascade
);


/* 주문 번호 시퀀스 생성 */
create sequence orderseq
start with 1
increment by 1;


/* 주문 리스트 조회시 필요한 view 생성 */
create view order_view
as 
select o.prodnum, o.id, o.ordernum, p.image, p.name, o.prodcolor, o.prodsize, o.quantity, (o.quantity * p.price2) as price, o.deliveryyn
from SHOP_ORDER_TBL o, SHOP_PRODUCT_TBL p, SHOP_MEMBER_TBL m
where o.prodnum = p.prodnum;


/* 주문 상세 조회시 필요한 view 생성 */
create view order_detail_view
as
select o.ordernum, m.name as username, m.eid, m.edomain, m.phone1, m.phone2, m.phone3,
o.ordername, o.orderadd, o.orderphone, o.orderreq, p.image, p.name,
o.prodcolor, o.prodsize, o.quantity, (o.quantity * p.price2) as price
from SHOP_ORDER_TBL o, SHOP_PRODUCT_TBL p, SHOP_MEMBER_TBL m
where o.prodnum = p.prodnum and m.id = o.id;



select * from shop_member_tbl;
select * from SHOP_PRODUCT_TBL;
select * from SHOP_CART_TBL;
select * from cart_view;
select * from SHOP_MEMBER_TBL;
select * from shop_order_tbl;
select * from order_view;
